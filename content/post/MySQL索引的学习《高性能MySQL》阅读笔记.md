---
title: "MySQL索引的学习《高性能MySQL》阅读笔记"
date: 2017-12-08T22:49:45+08:00
tags: ["mysql"]
tags: ['MySQL', '数据库']
draft: true
---

## 索引类型

### B+Tree索引

B-Tree 索引是数据库中最常用的索引，它使用 B+Tree 数据结构来存储数据。MySQL中不同的存储引擎使用B+Tree的方式也不同。这里记录一下MyISAM和InnoDB引擎的索引区别。

MyISAM引擎会对索引列的数据进行前缀压缩，使索引更小。InnoDB 按照原数据格式存储。

![image-20180522000605149](http://static.wangkaibo.com/FoT4E3bV8vjNucY0u27Q3D9A-EgL)

### 哈希索引

哈希索引（hash index）基于哈希表实现，只有精确匹配索引所有列的查询才有效。对于每一行数据，存储弓|擎都会对所有的索引|列计算一个哈希码(hash code)，哈希码是一个较小的值，并且不同键值的行计算出来的哈希码也不一样。哈希索引将所有的哈希码存储在索引中，同时在哈希表中保存指向每个数据行的指针。

InnoDB 引擎有一个特殊的功能叫做“自适应哈希索引（adaptive hash index），当InnoDB注意到某些索引值被使用得非常频繁时，它会在内存中基于 B-Tree 索引之上再创建一个哈希索引，这样就让B-Tree索引也具有哈希索引的一些优点，比如快速的哈希查找。这是一个完全自动的、内部的行为，用户无法控制或者配置，不过如果有必要，该功能可以关闭。

### 其他索引

空间数据索引（R-Tree）需使用GIS相关函数，MySQL的支持并不是很好，用到 GIS 可使用 `PostgreSQL`。

全文索引也不属于 MySQL 擅长的范畴。全文检索功能建议使用 `Elasticsearch` 实现。

此外，还有很多第三方的存储引擎使用不同类型的数据结构来存储索引。例如`TokuDB`使用分形树索引（fractal tree index）这是一类较新开发的数据结构，既有B-Tree 的很多优点，也避免了 B-Tree 的一些缺点。如果通读完本章，可以看到很多关于InnoDB的主题，包括聚簇索引、覆盖索引等。多数情况下，针对InnoDB的讨论也都适用于`TokuDB`。



## 索引策略

### 独立列索引



### 前缀索引



### 多列索引



#### 多列索引顺序



### 聚簇索引

聚簇索引并不是一种单独的索引类型，而是一种数据存储方式。具体的细节依赖于其实现方式，但InnoDB的聚簇索引实际上在同一个结构中保存了 B-Tree 索引和数据行。当表有聚簇索引时，它的数据行实际上存放在索引的叶子页中。术语`聚簇`表示数据行和相邻的键值紧凑地存储在一起（严格说是仅当主键是有序插入的时候）。因为无法同时把数据行存放在两个不同的地方，所以一个表只能有一个聚簇索引。因为是存储引擎负责实现索引，因此不是所有的存储引擎都支持聚簇索引。本节我们主要关注InnoDB，但是这里讨论的原理对于任何支持聚簇索引的存储引擎都是适用的。



下图展示了聚簇索引中的记录是如何存放的。注意到，叶子页包含了行的全部数据，但是节点页只包含了索引列。在这个案例中，索引|列包含的是整数值。



![image-20180523131409483](http://static.wangkaibo.com/FgdZpg_-mM9_ar1US3eAYPSrUzbx)





