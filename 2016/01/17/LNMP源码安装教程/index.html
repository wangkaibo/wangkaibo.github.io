<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>在崭新的 Centos 系统上编译安装 LNMP 环境完全版 | 语文不及格的人的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前几天买了个 VPS，因为之前接触 Nginx 不是很多，所以折腾 LNMP环境折腾了几个小时，所以我想重新安装一遍并写篇学习笔记，或者说教程，因此本文将从在崭新的 Centos 上搭建 LNMP 环境，为了所有软件都可以选择指定版本和安装配置，因此除了依赖包之外都采用源码包安装的方式来安装。废话不多说，刚刚把 VPS rebulid。注：本文属于新手友好型，能遇到的错误基本上都会遇到。😄
一、">
<meta property="og:type" content="article">
<meta property="og:title" content="在崭新的 Centos 系统上编译安装 LNMP 环境完全版">
<meta property="og:url" content="http://yoursite.com/2016/01/17/LNMP源码安装教程/index.html">
<meta property="og:site_name" content="语文不及格的人的博客">
<meta property="og:description" content="前几天买了个 VPS，因为之前接触 Nginx 不是很多，所以折腾 LNMP环境折腾了几个小时，所以我想重新安装一遍并写篇学习笔记，或者说教程，因此本文将从在崭新的 Centos 上搭建 LNMP 环境，为了所有软件都可以选择指定版本和安装配置，因此除了依赖包之外都采用源码包安装的方式来安装。废话不多说，刚刚把 VPS rebulid。注：本文属于新手友好型，能遇到的错误基本上都会遇到。😄
一、">
<meta property="og:updated_time" content="2016-01-20T17:03:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="在崭新的 Centos 系统上编译安装 LNMP 环境完全版">
<meta name="twitter:description" content="前几天买了个 VPS，因为之前接触 Nginx 不是很多，所以折腾 LNMP环境折腾了几个小时，所以我想重新安装一遍并写篇学习笔记，或者说教程，因此本文将从在崭新的 Centos 上搭建 LNMP 环境，为了所有软件都可以选择指定版本和安装配置，因此除了依赖包之外都采用源码包安装的方式来安装。废话不多说，刚刚把 VPS rebulid。注：本文属于新手友好型，能遇到的错误基本上都会遇到。😄
一、">
  
    <link rel="alternative" href="/atom.xml" title="语文不及格的人的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xpnci.com1.z0.glb.clouddn.com/5.pic.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Kaibo Wang</a></h1>
		</hgroup>

		
		<p class="header-subtitle">博客君需要更新</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/wangkaibo" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/wangkaibo" title="weibo">weibo</a>
					        
								<a class="mail" target="_blank" href="mailto:wkaiboo@gmail.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/LNMP/" style="font-size: 10px;">LNMP</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/PHP7/" style="font-size: 10px;">PHP7</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">一名后端工程师，现在居住在北京。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Kaibo Wang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://7xpnci.com1.z0.glb.clouddn.com/5.pic.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Kaibo Wang</h1>
			</hgroup>
			
			<p class="header-subtitle">博客君需要更新</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/wangkaibo" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/wangkaibo" title="weibo">weibo</a>
			        
						<a class="mail" target="_blank" href="mailto:wkaiboo@gmail.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-LNMP源码安装教程" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/17/LNMP源码安装教程/" class="article-date">
  	<time datetime="2016-01-17T14:33:06.000Z" itemprop="datePublished">2016-01-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      在崭新的 Centos 系统上编译安装 LNMP 环境完全版
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LNMP/">LNMP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP7/">PHP7</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>前几天买了个 VPS，因为之前接触 Nginx 不是很多，所以折腾 LNMP环境折腾了几个小时，所以我想重新安装一遍并写篇学习笔记，或者说教程，因此本文将从在崭新的 Centos 上搭建 LNMP 环境，为了所有软件都可以选择指定版本和安装配置，因此除了依赖包之外都采用源码包安装的方式来安装。废话不多说，刚刚把 VPS rebulid。<br>注：本文属于新手友好型，能遇到的错误基本上都会遇到。😄</p>
<h2 id="u4E00_u3001_u5B89_u88C5_Nginx"><a href="#u4E00_u3001_u5B89_u88C5_Nginx" class="headerlink" title="一、安装 Nginx"></a>一、安装 Nginx</h2><p>这里我选择的是1.8.0<br>执行命令下载并解压 Nginx 源码包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.8.0.tar.gz&#10;tar -xzvf nginx-1.8.0.tar.gz&#10;cd nginx-1.8.0</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>这里我们./Configure 肯定会报错的，因为我们这是一台崭新的 Centos 系统，缺少好多Nginx依赖包，这里我直接 ./configure 先试一下有什么错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure: error: C compiler cc is not found</span><br></pre></td></tr></table></figure>
<p>好吧，甚至连 gcc 都没有，先安装 gcc 才能编译源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc</span><br></pre></td></tr></table></figure>
<p>下面正式编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx/nginx.pid --lock-path=/var/lock/nginx.lock --user=nginx --group=nginx --with-http_ssl_module --with-http_flv_module --with-http_stub_status_module --with-http_gzip_static_module --http-client-body-temp-path=/var/tmp/nginx/client/ --http-proxy-temp-path=/var/tmp/nginx/proxy/ --http-fastcgi-temp-path=/var/tmp/nginx/fcgi/ --http-uwsgi-temp-path=/var/tmp/nginx/uwsgi --http-scgi-temp-path=/var/tmp/nginx/scgi --with-pcre</span><br></pre></td></tr></table></figure>
<p>又一个错误来了</p>
<blockquote>
<p>./configure: error: the HTTP rewrite module requires the PCRE library.<br>You can either disable the module by using –without-http_rewrite_module<br>option, or install the PCRE library into the system, or build the PCRE library<br>statically from the source with nginx by using –with-pcre=<path></path> option.</p>
</blockquote>
<p>这个错误我们看提示可以看出，Nginx 需要安装 PCRE Library，类似的错误提示还有很多，下面我们一次性将 Nginx 的依赖包都安装上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#23433;&#35013;PCRE &#24211;&#26159;&#20026;&#20351;&#29992; Nginx &#25903;&#25345; HTTP Rewrite &#27169;&#22359;&#12290;&#10;yum -y install pcre-devel&#10;// zlib&#10;yum -y install zlib-devel&#10;// openssl&#10;yum -y install openssl-devel</span><br></pre></td></tr></table></figure>
<p>再执行上面的 ./configure 命令，当出现下面提示时，说明我们已经配置好了可以编译了<br>因为我们配置时定义了 user 和 group，下面新建一个nginx 用户和nginx 用户组才能运行nginx服务进程 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># groupadd -r nginx&#10;# useradd -r -g nginx -s /bin/false -M nginx        &#10;# id nginx</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Configuration summary</p>
<ul>
<li>using system PCRE library</li>
<li>using system OpenSSL library</li>
<li>md5: using OpenSSL library</li>
<li>sha1: using OpenSSL library</li>
<li>using system zlib library<br>……</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make&#10;//&#19968;&#33324; make test &#21487;&#30465;&#30053;&#10;make test&#10;make install</span><br></pre></td></tr></table></figure>
<p>安装成功后我们还需要做一些配置</p>
<p>1、为Nginx提供sysv风格的服务脚本（ Red Hat Nginx Init Script Should work on RHEL, Fedora, CentOS. Tested on CentOS 5.  Save this file as /etc/init.d/nginx ）</p>
<p>在新建文件 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/rc.d/init.d/nginx</span><br></pre></td></tr></table></figure>
<p>内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh &#10;# &#10;# nginx - this script starts and stops the nginx daemon &#10;# &#10;# chkconfig:   - 85 15  &#10;# description:  Nginx is an HTTP(S) server, HTTP(S) reverse \ &#10;#               proxy and IMAP/POP3 proxy server &#10;# processname: nginx &#10;# config:      /etc/nginx/nginx.conf &#10;# config:      /etc/sysconfig/nginx &#10;# pidfile:     /var/run/nginx.pid &#10;  &#10;# Source function library. &#10;. /etc/rc.d/init.d/functions &#10;  &#10;# Source networking configuration. &#10;. /etc/sysconfig/network &#10;  &#10;# Check that networking is up. &#10;[ &#34;$NETWORKING&#34; = &#34;no&#34; ] &#38;&#38; exit 0 &#10;  &#10;nginx=&#34;/usr/sbin/nginx&#34; &#10;prog=$(basename $nginx) &#10;  &#10;NGINX_CONF_FILE=&#34;/etc/nginx/nginx.conf&#34; &#10;  &#10;[ -f /etc/sysconfig/nginx ] &#38;&#38; . /etc/sysconfig/nginx &#10;  &#10;lockfile=/var/lock/subsys/nginx &#10;  &#10;make_dirs() &#123; &#10;   # make required directories &#10;   user=`nginx -V 2&#62;&#38;1 | grep &#34;configure arguments:&#34; | sed &#39;s/[^*]*--user=\([^ ]*\).*/\1/g&#39; -` &#10;   options=`$nginx -V 2&#62;&#38;1 | grep &#39;configure arguments:&#39;` &#10;   for opt in $options; do &#10;       if [ `echo $opt | grep &#39;.*-temp-path&#39;` ]; then &#10;           value=`echo $opt | cut -d &#34;=&#34; -f 2` &#10;           if [ ! -d &#34;$value&#34; ]; then &#10;               # echo &#34;creating&#34; $value &#10;               mkdir -p $value &#38;&#38; chown -R $user $value &#10;           fi &#10;       fi &#10;   done &#10;&#125; &#10;  &#10;start() &#123; &#10;    [ -x $nginx ] || exit 5 &#10;    [ -f $NGINX_CONF_FILE ] || exit 6 &#10;    make_dirs &#10;    echo -n $&#34;Starting $prog: &#34; &#10;    daemon $nginx -c $NGINX_CONF_FILE &#10;    retval=$? &#10;    echo &#10;    [ $retval -eq 0 ] &#38;&#38; touch $lockfile &#10;    return $retval &#10;&#125; &#10;  &#10;stop() &#123; &#10;    echo -n $&#34;Stopping $prog: &#34; &#10;    killproc $prog -QUIT &#10;    retval=$? &#10;    echo &#10;    [ $retval -eq 0 ] &#38;&#38; rm -f $lockfile &#10;    return $retval &#10;&#125; &#10;  &#10;restart() &#123; &#10;    configtest || return $? &#10;    stop &#10;    sleep 1 &#10;    start &#10;&#125; &#10;  &#10;reload() &#123; &#10;    configtest || return $? &#10;    echo -n $&#34;Reloading $prog: &#34; &#10;    killproc $nginx -HUP &#10;    RETVAL=$? &#10;    echo &#10;&#125; &#10;  &#10;force_reload() &#123; &#10;    restart &#10;&#125; &#10;  &#10;configtest() &#123; &#10;  $nginx -t -c $NGINX_CONF_FILE &#10;&#125; &#10;  &#10;rh_status() &#123; &#10;    status $prog &#10;&#125; &#10;  &#10;rh_status_q() &#123; &#10;    rh_status &#62;/dev/null 2&#62;&#38;1 &#10;&#125; &#10;  &#10;case &#34;$1&#34; in &#10;    start) &#10;        rh_status_q &#38;&#38; exit 0 &#10;        $1 &#10;        ;; &#10;    stop) &#10;        rh_status_q || exit 0 &#10;        $1 &#10;        ;; &#10;    restart|configtest) &#10;        $1 &#10;        ;; &#10;    reload) &#10;        rh_status_q || exit 7 &#10;        $1 &#10;        ;; &#10;    force-reload) &#10;        force_reload &#10;        ;; &#10;    status) &#10;        rh_status &#10;        ;; &#10;    condrestart|try-restart) &#10;        rh_status_q || exit 0 &#10;            ;; &#10;    *) &#10;        echo $&#34;Usage: $0 &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest&#125;&#34; &#10;        exit 2 &#10;esac</span><br></pre></td></tr></table></figure>
<p> 给予刚才的文件可执行权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /etc/rc.d/init.d/nginx</span><br></pre></td></tr></table></figure>
<p>并把他添加到服务列表中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --add nginx&#10;chkconfig nginx on</span><br></pre></td></tr></table></figure>
<p>启动服务，并查看启动状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/nginx start&#10;netstat -tnlp  | grep nginx</span><br></pre></td></tr></table></figure>
<p>现在在可以访问了，Welcome to nginx!</p>
<p>重启服务命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/nginx restart&#10;/etc/init.d/nginx stop</span><br></pre></td></tr></table></figure>
<h2 id="u4E8C_u3001_u5B89_u88C5_MySQL"><a href="#u4E8C_u3001_u5B89_u88C5_MySQL" class="headerlink" title="二、安装 MySQL"></a>二、安装 MySQL</h2><h3 id="u4E0B_u8F7D_MySQL"><a href="#u4E0B_u8F7D_MySQL" class="headerlink" title="下载 MySQL"></a>下载 MySQL</h3><p>MySQL 的官方<a href="http://dev.mysql.com/downloads/mysql/" target="_blank" rel="external">下载地址</a>，进去选择 Source Code<br>这里我装的是5.6.28<br>如果你不想再去官网找的话，可以在你的下载目录直接执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://cdn.mysql.com//Downloads/MySQL-5.6/mysql-5.6.28.tar.gz&#10;tar -xzvf mysql-5.6.28.tar.gz &#10;cd mysql-5.6.28</span><br></pre></td></tr></table></figure>
<h3 id="u51C6_u5907_u5DE5_u4F5C"><a href="#u51C6_u5907_u5DE5_u4F5C" class="headerlink" title="准备工作"></a>准备工作</h3><p>安装前的准备工作，MySQL需要用到的依赖包依次安装上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc-c++&#10;yum -y install cmake&#10;yum -y install bison-devel&#10;yum -y install ncurses-devel</span><br></pre></td></tr></table></figure>
<h3 id="u7F16_u8BD1_u5B89_u88C5"><a href="#u7F16_u8BD1_u5B89_u88C5" class="headerlink" title="编译安装"></a>编译安装</h3><p>编译配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake \&#10;-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \&#10;-DMYSQL_DATADIR=/usr/local/mysql/data \&#10;-DSYSCONFDIR=/etc \&#10;-DWITH_MYISAM_STORAGE_ENGINE=1 \&#10;-DWITH_INNOBASE_STORAGE_ENGINE=1 \&#10;-DWITH_MEMORY_STORAGE_ENGINE=1 \&#10;-DWITH_READLINE=1 \&#10;-DMYSQL_UNIX_ADDR=/var/lib/mysql/mysql.sock \&#10;-DMYSQL_TCP_PORT=3306 \&#10;-DENABLED_LOCAL_INFILE=1 \&#10;-DWITH_PARTITION_STORAGE_ENGINE=1 \&#10;-DEXTRA_CHARSETS=all \&#10;-DDEFAULT_CHARSET=utf8 \&#10;-DDEFAULT_COLLATION=utf8_general_ci</span><br></pre></td></tr></table></figure>
<p>参数详细配置，参考MySQL官方文档的<a href="http://dev.mysql.com/doc/refman/5.5/en/source-configuration-options.html" target="_blank" rel="external">MySQL Source-Configuration Options</a><br>我这里出现了以下警告：</p>
<blockquote>
<p>CMake Warning:<br>  Manually-specified variables were not used by the project:</p>
<p>  WITH_MEMORY_STORAGE_ENGINE</p>
<p>  WITH_READLINE</p>
<p>– Build files have been written to: /root/lnmp_source/mysql-5.6.28</p>
</blockquote>
<p>提示两个配置项没有应用上，我干脆就把这两项配置去掉了重新./configure 了一下，这次没有警告了<br>我查了下这两项的作用：</p>
<p>-WITH_MEMORY_STORAGE_ENGINE #支持Memory引擎<br>-DWITH_READLINE=1 \ #快捷键功能</p>
<p>如果用到再做配置，下面安装</p>
<p>好了开始编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>
<p> MySQL 编译时间比较长…我这单核 VPS…30分钟后…</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure>
<p> 创建 MySQL 的用户和用户组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql&#10;useradd -g mysql mysql</span><br></pre></td></tr></table></figure>
<p>修改/usr/local/mysql权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql:mysql /usr/local/mysql</span><br></pre></td></tr></table></figure>
<h3 id="u521D_u59CB_u5316_u914D_u7F6E"><a href="#u521D_u59CB_u5316_u914D_u7F6E" class="headerlink" title="初始化配置"></a>初始化配置</h3><p>进入安装路径</p>
<p>cd /usr/local/mysql<br>进入安装路径，执行初始化配置脚本，创建系统自带的数据库和表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scripts/mysql_install_db --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --user=mysql</span><br></pre></td></tr></table></figure>
<p>这里执行会报错，如下：</p>
<blockquote>
<p>./scripts/mysql_install_db: /usr/bin/perl: bad interpreter: No such file or directory<br>原因是系统没有安装Perl 和 Perl-devel</p>
</blockquote>
<p>解决办法，执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install perl perl-devel</span><br></pre></td></tr></table></figure>
<p>安装完成后再执行 MySQL 初始化脚本就可以了<br>现在应该可以开启 MySQL 了。</p>
<p>同样将 MySQL 提供的sysv风格的服务脚本复制到 /etc/init.d/mysql目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp support-files/mysql.server /etc/init.d/mysql&#10;// &#35774;&#32622;&#24320;&#26426;&#21551;&#21160;&#10;chkconfig mysql on&#10;// &#21551;&#21160;&#26381;&#21153;&#10;service mysql start  // &#21551;&#21160;MySQL&#10;// &#25110;&#32773;&#20351;&#29992;&#10;/etc/init.d/mysql start // &#21551;&#21160; MySQL</span><br></pre></td></tr></table></figure>
<p>将 MySQL 加入环境变量，修改/etc/profile文件，在文件末尾添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=/usr/local/mysql/bin:$PATH&#10;export PATH</span><br></pre></td></tr></table></figure>
<p>保存并关闭文件，运行下面的命令让配置生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
<p>MySQL 跑起来了，我极低配 512 内存的 VPS 瞬间被占用了 400MB 啊<br>修改 /usr/local/mysql/my.cnf 中的以下几项配置（没有该项可以添加）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table_definition_cache=400&#10;table_open_cache=256</span><br></pre></td></tr></table></figure>
<p>然后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/mysql restart</span><br></pre></td></tr></table></figure>
<p>瞬间清爽了，只能牺牲性能了😂。</p>
<h3 id="u4FEE_u6539_MySQL_root__u8D26_u6237_u5BC6_u7801"><a href="#u4FEE_u6539_MySQL_root__u8D26_u6237_u5BC6_u7801" class="headerlink" title="修改 MySQL root 账户密码"></a>修改 MySQL root 账户密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot  &#10;mysql&#62; SET PASSWORD = PASSWORD(&#39;YOUR PASSWORD&#39;);</span><br></pre></td></tr></table></figure>
<h3 id="u4FEE_u6539_u9632_u706B_u5899_u914D_u7F6E"><a href="#u4FEE_u6539_u9632_u706B_u5899_u914D_u7F6E" class="headerlink" title="修改防火墙配置"></a>修改防火墙配置</h3><p>打开/etc/sysconfig/iptables</p>
<p>在“-A INPUT –m state –state NEW –m tcp –p –dport 22 –j ACCEPT”，下添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-A INPUT -m state --state NEW -m tcp -p -dport 3306 -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>然后保存，并关闭该文件，在终端内运行下面的命令，刷新防火墙配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables restart</span><br></pre></td></tr></table></figure>
<p>MySQL 安装完毕。</p>
<h2 id="u5B89_u88C5_PHP7"><a href="#u5B89_u88C5_PHP7" class="headerlink" title="安装 PHP7"></a>安装 PHP7</h2><h3 id="u4E0B_u8F7D_PHP7_u6E90_u7801_u5305"><a href="#u4E0B_u8F7D_PHP7_u6E90_u7801_u5305" class="headerlink" title="下载 PHP7源码包"></a>下载 PHP7源码包</h3><p>我这里下载的是 PHP 7，下载别的版本去<a href="http://php.net/downloads.php" target="_blank" rel="external">php.net</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://cn2.php.net/distributions/php-7.0.2.tar.gz&#10;tar -xzvf php-7.0.2.tar.gz&#10;cd php-7.0.2</span><br></pre></td></tr></table></figure>
<h3 id="u7F16_u8BD1_u914D_u7F6E"><a href="#u7F16_u8BD1_u914D_u7F6E" class="headerlink" title="编译配置"></a>编译配置</h3><p>如果我们直接配置的话应该会报错，我们还需要安装一些 PHP 的依赖包，编译配置一下试试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --enable-fpm --with-mysql</span><br></pre></td></tr></table></figure>
<p>首先报以下错误：</p>
<blockquote>
<p>configure: error: xml2-config not found. Please check your libxml2 installation.</p>
</blockquote>
<p>缺少 libxml2，直接使用 yum 方式安装 libxml2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y libxml2</span><br></pre></td></tr></table></figure>
<p>下面一口气把所有的PHP 用到的软件包都安装上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel openssl openssl-devel openldap openldap-devel nss_ldap openldap-clients openldap-servers php-mysqlnd libmcrypt-devel libtidy libtidy-devel recode recode-devel libxpm-devel</span><br></pre></td></tr></table></figure>
<p>安装完之后可以编译配置了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/php7 --with-config-file-path=/etc/php7 --with-mysql=mysqlnd --with-pdo-mysql=mysqlnd --with-mysqli=mysqlnd --with-gd --with-iconv --with-zlib --enable-xml --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --enable-mbregex --enable-fpm --enable-mbstring --enable-ftp --enable-gd-native-ttf --with-openssl --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --without-pear --with-gettext --enable-session --with-mcrypt --with-curl --with-jpeg-dir --with-freetype-dir --with-xpm-dir=/usr --with-bz2</span><br></pre></td></tr></table></figure>
<p>注意前两个配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--prefix=/usr/local/php7 //&#23433;&#35013;&#20301;&#32622;&#10;--with-config-file-path=/etc/php7 //&#37197;&#32622;&#25991;&#20214;&#20301;&#32622;</span><br></pre></td></tr></table></figure>
<p>如果还会报错，可能是缺少依赖包，按照提示安装就可以了。</p>
<blockquote>
<p>configure: error: xpm.h not found.</p>
</blockquote>
<p>上面忘了安装 libxpm 和 mcrypt 扩展<br>安装 libXpm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libXpm-devel</span><br></pre></td></tr></table></figure>
<p>好多 yum 源中没有 mcrypt，担心第三方源不可靠，我选择使用源码安装 mcrypt，切换到另一个目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://mcrypt.hellug.gr/pub/crypto/mcrypt/libmcrypt/libmcrypt-2.5.6.tar.gz&#10;tar -zxvf libmcrypt-2.5.6.tar.gz&#10;cd libmcrypt-2.5.6.tar.gz&#10;make &#38;&#38; make install</span><br></pre></td></tr></table></figure>
<p>再配置，编译安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make&#10;sudo make install</span><br></pre></td></tr></table></figure>
<p>这里列出 PHP 编译配置常见错误和解决办法：</p>
<blockquote>
<p>configure: error: xslt-config not found. Please reinstall the libxslt &gt;= 1.1.0 distribution</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libxslt-devel</span><br></pre></td></tr></table></figure>
<p>configure: error: Could not find net-snmp-config binary. Please check your net-snmp installation.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install net-snmp-devel</span><br></pre></td></tr></table></figure>
<p>configure: error: Please reinstall readline - I cannot find readline.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install readline-devel</span><br></pre></td></tr></table></figure>
<p>configure: error: Cannot find pspell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install aspell-devel</span><br></pre></td></tr></table></figure>
<p>checking for unixODBC support… configure: error: ODBC header file ‘/usr/include/sqlext.h’ not found!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install unixODBC-devel</span><br></pre></td></tr></table></figure>
<p>configure: error: Unable to detect ICU prefix or /usr/bin/icu-config failed. Please verify ICU install prefix and make sure icu-config works.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libicu-devel</span><br></pre></td></tr></table></figure>
<p>configure: error: utf8mime2text() has new signature, but U8TCANONICAL is missing. This should not happen. Check config.log for additional information.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libc-client-devel</span><br></pre></td></tr></table></figure>
<p>configure: error: freetype.h not found.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install freetype-devel</span><br></pre></td></tr></table></figure>
<p>configure: error: xpm.h not found.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libXpm-devel</span><br></pre></td></tr></table></figure>
<p>configure: error: png.h not found.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libpng-devel</span><br></pre></td></tr></table></figure>
<p>configure: error: vpx_codec.h not found.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libvpx-devel</span><br></pre></td></tr></table></figure>
<p>configure: error: Cannot find enchant</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install enchant-devel</span><br></pre></td></tr></table></figure>
<p>configure: error: Please reinstall the libcurl distribution - easy.h should be in /include/curl/</p>
</blockquote>
<h3 id="u914D_u7F6E_Nginx"><a href="#u914D_u7F6E_Nginx" class="headerlink" title="配置 Nginx"></a>配置 Nginx</h3><p>nginx本身不能处理PHP，它只是个web服务器，当接收到请求后，如果是php请求，则发给php解释器处理，并把结果返回给客户端。</p>
<p>nginx一般是把请求发fastcgi管理进程处理，fascgi管理进程选择cgi子进程处理结果并返回被nginx</p>
<p>首先修改 Nginx 的配置，刚才安装时配置的配置文件目录是 /etc/nginx/nginx.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000&#10;#&#10;location ~ .php$ &#123;&#10;&#9;root /var/www; //&#26681;&#30446;&#24405; root&#9;&#10;&#9;fastcgi_pass 127.0.0.1:9000;&#10;&#9;fastcgi_index index.php;&#10;&#9;fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;&#10;&#9;include fastcgi_params;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>这里需要注意 location ~.php 的配置块的 root 根目录一定要跟 server 块的配置一样，否则 php 文件会不能解析，会报 File not found 错误。</p>
<p>同时也建议在location / 配置下的 index 加上 index.php</p>
<p>配置好 Nginx 可以先尝试启动 php-fpm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/php7/sbin/php-fpm</span><br></pre></td></tr></table></figure>
<p>嗯，是的，应该会报下面的错误😄</p>
<blockquote>
<p>ERROR: failed to open configuration file ‘/local/php7/etc/php-fpm.conf’: No such file or directory (2)<br>[20-Jan-2016 10:56:50] ERROR: failed to load configuration file ‘/local/php7/etc/php-fpm.conf’</p>
</blockquote>
<p>将默认的配置文件 cp 为正房</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /local/php7/etc/php-fpm.conf.default /local/php7/etc/php-fpm.conf</span><br></pre></td></tr></table></figure>
<p>如果这时候启动 php-fpm 会报下面的错误</p>
<blockquote>
<p>WARNING: Nothing matches the include pattern ‘/local/php7/etc/php-fpm.d/*.conf’ from /local/php7/etc/php-fpm.conf at line 125.<br>[20-Jan-2016 11:03:40] ERROR: No pool defined. at least one pool section must be specified in config file</p>
</blockquote>
<p>根据错误提示信息，还是初始化配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /local/php7/etc/php-fpm.d/www.conf.default /local/php7/etc/php-fpm.d/www.conf</span><br></pre></td></tr></table></figure>
<p>这时候应该可以启动了。<br>下面测试一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /var/www&#10;echo &#34;&#60;?php phpinfo();&#34; &#62; index.php</span><br></pre></td></tr></table></figure>
<p>到此为止，整个安装过程就写完了.</p>
<p>零零散散地看了网上很多的教程，所以决定总（fu）结（zhi）一（yi）下（fen），描述比较傻瓜化，安装过程中基本所有的错误就提到了。希望能对刚踏入 Linux 服务端的同学有所帮助。</p>
<p>参考文章：</p>
<ul>
<li><a href="http://xyuex.blog.51cto.com/5131937/1013414" target="_blank" rel="external">Nginx 源码编译安装</a></li>
<li><a href="http://www.cnblogs.com/xiongpq/p/3384681.html" target="_blank" rel="external">CentOS 6.4下编译安装MySQL 5.6.14</a></li>
<li><a href="http://blog.wuxu92.com/compile-and-install-php7-beta1/" target="_blank" rel="external">编译安装PHP7 beta1</a></li>
<li><a href="https://coderwall.com/p/ggmpfa/php-configuration-error-and-solutions-in-rpm" target="_blank" rel="external">PHP configuration error and Solutions in RPM</a></li>
</ul>

      
    </div>
    
  </div>
  
    
  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="LNMP源码安装教程" data-title="在崭新的 Centos 系统上编译安装 LNMP 环境完全版" data-url="http://yoursite.com/2016/01/17/LNMP源码安装教程/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"wangkaibo"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Kaibo Wang
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>